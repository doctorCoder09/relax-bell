<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relaxation Bell</title>
<style>
  body { margin:0; font-family:"Inter",sans-serif; transition: background-color 0.3s, color 0.3s; background-color:#ffffff; color:#1a202c; }
  body.dark { background-color:#1a202c; color:#f7fafc; }

  .container { display:flex; flex-direction:column; align-items:center; padding:20px; }
  .image-container { position:relative; width:100%; max-width:800px; aspect-ratio:16/9; overflow:hidden; border-radius:12px; margin-bottom:20px; cursor:pointer; transition: transform 0.3s; }
  .image-container:hover img { transform: scale(1.05); }
  .image-container img { width:100%; height:100%; object-fit:cover; transition: transform 0.3s; }

  .theme-button { position:fixed; top:15px; right:15px; width:40px; height:40px; font-size:1.2rem; padding:5px; border-radius:50%; background-color:#3182ce; color:white; border:none; cursor:pointer; transition: all 0.2s ease; z-index:1000; }
  .theme-button:hover { transform: scale(1.2); background-color:#2b6cb0; }

  .controls { max-width:500px; width:100%; display:flex; flex-direction:column; gap:15px; }
  input[type="range"], input[type="time"] { width:100%; }
  .button-toggle { padding:10px 20px; border:none; border-radius:8px; font-size:1rem; cursor:pointer; color:white; transition: transform 0.2s; }
  .button-toggle:hover { transform: scale(1.05); }
  .button-on { background-color:#38a169; } /* xanh = b·∫≠t */
  .button-off { background-color:#e53e3e; } /* ƒë·ªè = t·∫Øt */

  /* CSS Progress Bar Animation */
  @keyframes shrinkWidth {
    from { width: 100%; }
    to { width: 0%; }
  }
  .progress-bar {
    position:absolute;
    top:0; left:0;
    height:5px;
    background:#38a169;
    width:100%;
    z-index:10;
  }
</style>
</head>
<body>

<button id="themeButton" class="theme-button" title="ƒê·ªïi theme">üåô</button>

<div class="container">
  <h1>Relaxation Bell</h1>

  <div id="imageContainer" class="image-container">
    <div id="progressBar" class="progress-bar"></div>
    <img id="mainImage" src="https://picsum.photos/1200/600?blur=1" alt="Relaxation">
  </div>

  <div class="controls">
    <label>√Çm l∆∞·ª£ng: <span id="volumeLabel">80%</span></label>
    <input type="range" id="volumeRange" min="0" max="100" step="5" value="80">

    <label>Kho·∫£ng nh·∫Øc: <span id="intervalLabel">30 ph√∫t</span></label>
    <input type="range" id="intervalRange" min="5" max="60" step="5" value="30">

    <label>Th·ªùi gian ho·∫°t ƒë·ªông:</label>
    <div style="display:flex; gap:10px;">
      <input type="time" id="startTime" value="07:30">
      <span>‚Üí</span>
      <input type="time" id="endTime" value="16:30">
    </div>

    <button id="toggleBell" class="button-toggle button-on">Chu√¥ng B·∫≠t</button>
  </div>
</div>

<script>
  // --- Theme & Image ---
  const themeButton = document.getElementById('themeButton');
  const body = document.body;
  const mainImage = document.getElementById('mainImage');
  const IMAGE_LIGHT = "https://picsum.photos/1200/600?blur=1";
  const IMAGE_DARK = "https://picsum.photos/1200/600?blur=1";

  let isDark = localStorage.getItem('theme') === 'dark' || (window.matchMedia("(prefers-color-scheme: dark)").matches && !localStorage.getItem('theme'));
  function applyTheme(theme){
    if(theme==='dark'){ body.classList.add('dark'); mainImage.src=IMAGE_DARK; }
    else { body.classList.remove('dark'); mainImage.src=IMAGE_LIGHT; }
    localStorage.setItem('theme', theme);
  }
  applyTheme(isDark?'dark':'light');

  themeButton.onclick = () => {
    isDark = !isDark;
    applyTheme(isDark?'dark':'light');
    themeButton.textContent = isDark ? "üåû" : "üåô";
  };

  // --- Bell Sound ---
  const BELL_URL = "https://soundbible.com/mp3/Temple%20Bell-SoundBible.com-756181215.mp3";
  const audio = new Audio(BELL_URL); 
  audio.preload="auto"; 
  audio.volume = localStorage.getItem('volume') ? localStorage.getItem('volume')/100 : 0.8;

  mainImage.onclick = () => {
    if(audio.paused){
      audio.currentTime = 0;
      audio.play().catch(e=>console.warn(e));
    }
  };

  // --- Controls ---
  const volumeRange = document.getElementById('volumeRange');
  const volumeLabel = document.getElementById('volumeLabel');
  volumeRange.value = localStorage.getItem('volume') || 80;
  volumeLabel.textContent = volumeRange.value + '%';
  audio.volume = volumeRange.value/100;

  volumeRange.addEventListener('input', e=>{
    const vol = e.target.value;
    audio.volume = vol/100;
    volumeLabel.textContent = vol + '%';
    localStorage.setItem('volume', vol);
  });

  const intervalRange = document.getElementById('intervalRange');
  const intervalLabel = document.getElementById('intervalLabel');
  intervalRange.value = localStorage.getItem('interval') || 30;
  intervalLabel.textContent = intervalRange.value + ' ph√∫t';
  let intervalMinutes = parseInt(intervalRange.value); 

  intervalRange.addEventListener('input', e=>{
    intervalMinutes = parseInt(e.target.value); 
    intervalLabel.textContent = intervalMinutes + ' ph√∫t'; 
    localStorage.setItem('interval', intervalMinutes);
    resetTimer();
  });

  const startTimeInput = document.getElementById('startTime');
  const endTimeInput = document.getElementById('endTime');
  startTimeInput.value = localStorage.getItem('startTime') || "07:30";
  endTimeInput.value = localStorage.getItem('endTime') || "16:30";

  startTimeInput.addEventListener('input', e=>{ localStorage.setItem('startTime', e.target.value); resetTimer(); });
  endTimeInput.addEventListener('input', e=>{ localStorage.setItem('endTime', e.target.value); resetTimer(); });

  let isEnabled = localStorage.getItem('bellEnabled') !== 'false'; // default true
  const toggleBell = document.getElementById('toggleBell');
  function updateToggleButton(){
    toggleBell.textContent = isEnabled ? "Chu√¥ng B·∫≠t" : "Chu√¥ng T·∫Øt";
    toggleBell.className = `button-toggle ${isEnabled?'button-on':'button-off'}`;
    localStorage.setItem('bellEnabled', isEnabled);
  }
  toggleBell.onclick = ()=>{
    isEnabled = !isEnabled;
    updateToggleButton();
    resetTimer();
  };
  updateToggleButton();

  // --- Progress Bar Animation ---
  const progressBar = document.getElementById('progressBar');
  function startProgressBar(durationMinutes){
    progressBar.style.animation = 'none'; // reset
    void progressBar.offsetWidth; // force reflow
    progressBar.style.animation = `shrinkWidth ${durationMinutes*60}s linear forwards`;
  }

  function parseTime(str){
    const [h,m] = str.split(':').map(Number);
    const d = new Date();
    d.setHours(h,m,0,0);
    return d;
  }

  function checkAndPlay(){
    if(!isEnabled) return;
    const now = new Date();
    let start = parseTime(startTimeInput.value);
    let end = parseTime(endTimeInput.value);

    if(end < start) end.setDate(end.getDate() + 1);

    if(now >= start && now <= end){
      mainImage.click();
      startProgressBar(intervalMinutes);
    }
  }

  let timer;
  function resetTimer(){
    if(timer) clearInterval(timer);
    if(isEnabled){ 
      checkAndPlay(); 
      startProgressBar(intervalMinutes); 
      timer = setInterval(checkAndPlay, intervalMinutes * 60 * 1000); 
    } else {
      progressBar.style.animation = 'none';
      progressBar.style.width = '0%';
    }
  }

  resetTimer();
</script>

</body>
</html>

